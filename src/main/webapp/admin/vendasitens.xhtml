<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <!-- Título da página -->
    <ui:define name="title">
        <h:outputText value="Venda"></h:outputText>
    </ui:define>

    <!-- Conteúdo principal da página -->
    <ui:define name="content">
        <h:form id="frmList">
            <h:panelGroup id="pngList">
                
                <!-- Componente de feedback para mensagens (sucesso, erro, etc.) -->
                <p:growl id="growl" showDetail="true" />

                <!-- Tabela de vendas existente -->
                <p:dataTable id="datalist" value="#{vendaController.vendaAll()}" var="item"
                             selectionMode="single" selection="#{vendaController.selected}"
                             widgetVar="datalistVendaWidgetVar"
                             rowKey="#{item.num_cupom}"
                             paginator="true"
                             rows="5"
                             rowsPerPageTemplate="5,10,50,100"
                             emptyMessage="Nenhuma venda cadastrada...">

                    <!-- Coluna para exibir o número do cupom -->
                    <p:column width="4%" sortBy="#{item.num_cupom}" filterBy="#{item.num_cupom}">
                        <f:facet name="header">
                            <h:outputText value="Num Cupom"/>
                        </f:facet>
                        <h:outputText value="#{item.num_cupom}"/>
                    </p:column>

                    <!-- Coluna para exibir o valor total da venda -->
                    <p:column width="4%" sortBy="#{item.vlr_total_vda}" filterBy="#{item.vlr_total_vda}">
                        <f:facet name="header">
                            <h:outputText value="Valor Total Venda"/>
                        </f:facet>
                        <h:outputText value="#{item.vlr_total_vda}">
                            <f:convertNumber type="currency" currencySymbol="R$" locale="pt_BR" minFractionDigits="2" maxFractionDigits="2"/>
                        </h:outputText>
                    </p:column>

                    <!-- Rodapé da tabela com botões de ação -->
                    <f:facet name="footer">
                        <!-- Botão para incluir nova venda -->
                        <p:commandButton id="btnCreate" value="Incluir Venda" icon="pi pi-file"
                                         actionListener="#{vendaController.toggleIncluirVenda}"
                                         update=":frmList:vendaFormTable" />
                        
                        <!-- Botão para excluir a venda selecionada -->
                        <p:commandButton id="btnDelete" icon="pi pi-trash" value="Excluir Venda"
                                         actionListener="#{vendaController.deletarVenda()}" update="frmList"
                                         disabled="#{empty vendaController.selected}">
                            <p:confirm header="Confirmar Exclusão" message="Você confirma a exclusão do registro?"
                                       icon="ui-icon-alert" />
                        </p:commandButton>
                    </f:facet>
                </p:dataTable>

                <!-- Formulário de inclusão de nova venda -->
                <p:panel header="Incluir Nova Venda" style="margin-top:20px; width: 100%;">
                    <h:panelGrid id="vendaFormTable" columns="4" cellpadding="5" cellspacing="5" style="width: 100%;">
                        
                        <!-- Primeira linha - Usuário e Cliente -->
                        <p:outputLabel value="Usuário:" for="usuario" />
                        <p:selectOneMenu id="usuario" value="#{vendaController.venda.cod_usuario}"
                                         required="true" requiredMessage="O atributo Usuário é obrigatório!"
                                         style="width: 100%;" disabled="true">
                            <f:selectItem itemLabel="Diane" itemValue="Diane" />
                        </p:selectOneMenu>

                        <p:outputLabel value="Cliente:" for="cod_cliente" />
                        <p:selectOneMenu id="cod_cliente" value="#{vendaController.venda.cod_cliente}"
                                         required="true" requiredMessage="O atributo Cliente é obrigatório!"
                                         style="width: 40%;">
                            <f:selectItem itemLabel="Selecione um Cliente..."/>
                            <f:selectItems value="#{clienteController.clienteAll()}"
                                           var="codclienteItem"
                                           itemValue="#{codclienteItem}"
                                           itemLabel="#{codclienteItem.nome}"/>
                            <p:ajax event="change" update="iptdesCliente iptdesUfCli" listener="#{vendaController.updateClienteInfo}" partialSubmit="true"/>
                        </p:selectOneMenu>

                        <!-- Segunda linha - Descrição do Cliente e UF -->
                        <p:outputLabel id="opldesCliente" value="Descrição do Cliente:" for="iptdesCliente"/>
                        <p:inputText id="iptdesCliente" size="40" label="desCliente" required="true"
                                     style="width: 40%;" requiredMessage="O atributo Descrição do Cliente é obrigatório"
                                     value="#{vendaController.venda.des_cliente}" />

                        <p:outputLabel id="opldesUfCli" value="UF:" for="iptdesUfCli"/>
                        <p:inputText id="iptdesUfCli" size="10" label="desUfCli" required="true"
                                     style="width: 40%;" requiredMessage="O atributo UF é obrigatório"
                                     value="#{vendaController.venda.des_uf_cli}" />

                        <!-- Terceira linha - Registro e Tipo de venda -->
                        <p:outputLabel id="opldtaHorMov" for="ipmdtaHorMov" value="Registro:" />
                        <p:inputText id="ipmdtaHorMov" value="#{vendaController.venda.dta_hor_mov}" disabled="true" style="width: 40%;">
                            <f:convertDateTime pattern="dd/MM/yy HH:mm" timeZone="America/Sao_Paulo" />
                        </p:inputText>

                        <p:outputLabel id="opltipvenda" value="Tipo de venda:" for="ipttipvenda"/>
                        <p:selectOneMenu id="ipttipvenda" value="#{vendaController.venda.tip_venda}" required="true" style="width: 40%;">
                            <f:selectItem itemLabel="Selecione um Tipo..." itemValue="#{null}" />
                            <f:selectItem itemLabel="Vista" itemValue="301" />
                            <f:selectItem itemLabel="Parcelado" itemValue="302" />
                            <p:ajax event="change" update="iptcodOperacao" listener="#{vendaController.updateCodOperacao}" partialSubmit="true"/>
                        </p:selectOneMenu>

                        <!-- Quarta linha - Operação e quantidade de itens -->
                        <p:outputLabel id="oplcodOperacao" value="Operação:" for="iptcodOperacao"/>
                        <p:inputNumber id="iptcodOperacao" value="#{vendaController.venda.cod_operacao}" minValue="1" decimalPlaces="0" style="width: 100%;" />

                        <p:outputLabel id="oplqtdItens" value="Quantidade de itens:" for="iptqtdItens"/>
                        <p:inputNumber id="iptqtdItens" value="#{vendaController.venda.qtd_itens}" readonly="true" style="width: 40%;" />

                        <!-- Quarta linha - Valor total da venda -->
                        <p:outputLabel id="oplvlrTotalVda" value="Valor total venda:" for="iptvlrTotalVda"/>
                        <p:inputText id="iptvlrTotalVda" size="40" label="vlrTotalVda" readonly="true" style="width: 40%;">
                            <f:convertNumber minFractionDigits="2" maxFractionDigits="2" />
                        </p:inputText>

                        <!-- Botão para salvar a nova venda -->
                        <p:commandButton actionListener="#{vendaController.adicionarVenda()}"
                                         icon="pi pi-save" value="Cadastrar"
                                         update="frmList, vendaFormTable" style="margin-top: 20px; width: 100%;"/>
                    </h:panelGrid>
                </p:panel>
            </h:panelGroup>
        </h:form>
    </ui:define>
</ui:composition>
